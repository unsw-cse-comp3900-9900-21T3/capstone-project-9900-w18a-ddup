# E-commerce System Backend

**implement with Spring Framework**

---

[![Run Gradle Test and Deploy to Server](https://github.com/unsw-cse-comp3900-9900-21T3/capstone-project-9900-w18a-ddup/actions/workflows/test-deploy-dev.yml/badge.svg?branch=backend)](https://github.com/unsw-cse-comp3900-9900-21T3/capstone-project-9900-w18a-ddup/actions/workflows/test-deploy-dev.yml)

## How to run

The API will be hosted on port 8080. Swagger API doc will be hosted on [http://<YOUR-HOST>:8080/swagger-ui.html]()

### Requirements

```shell
# install JDK and docker require root access
bash init.sh
```

### Development

```shell
# Run PostgreSQL and Redis
pushd docker/dev
docker-compose up -d
popd
./gradlew bootRun
```

### Deployment

```shell
./gradlew jibDockerBuild
cd docker/submit
docker-compose up
```

## Imported Packages

- Spring Boot
- Spring Security
- Spring Cache
- Spring Data JPA
- PostgreSQL Driver
- Jackson (Serialization and Deserialization)
- Lettuce (Redis connection driver)
- OpenAPI (generate OpenAPI Doc)
- problem-spring-web (beautify http error output)
- ModelMapper (Convert between DTO and entity)
- Embedded H2 Database (test)
- Embedded Redis (test)
- jib (compile docker image)

## Basic Flow Structure

<!-- generated by mermaid compile action - START -->
![~mermaid diagram 1~](.resources/README-md-1.png)
<details>
  <summary>Mermaid markup</summary>

```mermaid
graph LR
A[Client] --> |http| B[Controller]
B--> |http|A
B --> C[Security Filter]
C --> D[Service]
D --> B
D --> E[Cache]
E --> D
D --> F[Repository]
F --> D
F --> G[Database]
G --> F
```

</details>
<!-- generated by mermaid compile action - END -->

## Development Workflow

<!-- generated by mermaid compile action - START -->
![~mermaid diagram 2~](.resources/README-md-2.png)
<details>
  <summary>Mermaid markup</summary>

```mermaid
graph LR
A[local repo] -->|git push| B[remote repo]
B --> |github action|C{gradle test}
C -->|Pass| D[gradle jib build]
C -->|Fail| E[send notification]
D --> F[push docker image to hub]
F -->|ssh to server|G[docker-compose up]
G --> H[host OpenAPI doc && backend]
```

</details>
<!-- generated by mermaid compile action - END -->

## Some Development Tips

- About Getter and Setter, if the object is mutable, always create a new instance. For example, `Date` and `byte[]`.
- Use `BigDecimal` when handling price value.
- Use `ModelMapper` for converting `DTO` and `Entity`. Make sure the names of properties are exactly same.
- Cache has not been tested!! [TODO]
- `User.email` is mapped to `username`
- Test DB is totally new, which means you need to add date first then do your test process.
- Test DB will be truncated after program terminate.
- Test DB and Redis may be switched to docker containers.
- When you are handling OneToMany and ManyToOne relations, map object on both
  side. [Example](./src/test/java/dev/shawnking07/ecomm_system_backend/repository/OrderRepositoryTest.java)
